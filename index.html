<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>L457 – Tech, Design & Music</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="styles.css" />
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
  <!-- Storage (for image uploads). Safe to include; we check availability at runtime. -->
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-storage-compat.js"></script>
  <script src="firebase-config.js"></script>
  <script defer src="script.js"></script>
</head>
<body>
  <header class="header">
    <div class="header-content">
      <a href="/" class="logo" aria-label="L457 Home">
        <svg viewBox="0 0 512 512" xmlns="http://www.w3.org/2000/svg" role="img" aria-hidden="true">
          <g fill="none" stroke="currentColor" stroke-width="20" stroke-linecap="round" stroke-linejoin="round">
            <!-- Outer globe -->
            <circle cx="256" cy="256" r="216"/>
            <!-- Latitudes (approximate to the provided mark) -->
            <ellipse cx="256" cy="256" rx="216" ry="96"/>
            <ellipse cx="256" cy="256" rx="140" ry="216"/>
          </g>
          <!-- Center plate -->
          <rect x="128" y="216" width="256" height="80" rx="28" fill="currentColor"/>
          <text x="256" y="268" text-anchor="middle" dominant-baseline="middle" fill="#0b0b0c" font-family="Inter, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif" font-weight="700" font-size="64">L457</text>
          <!-- Pointer (cursor) -->
          <g fill="currentColor">
            <polygon points="376,296 472,332 430,360 452,424 428,436 404,372 368,412"/>
          </g>
        </svg>
      </a>
      <div class="header-actions">
        <button class="search-btn" id="searchBtn">Search</button>
      </div>
    </div>
  </header>

  <script>
    document.addEventListener('DOMContentLoaded', () => {
      const headerActions = document.querySelector('.header-actions');
      if (headerActions && !document.getElementById('adminBtn')) {
        const btn = document.createElement('button');
        btn.className = 'admin-btn';
        btn.id = 'adminBtn';
        btn.textContent = 'Admin';
        headerActions.appendChild(btn);
      }
    });
  </script>

  <!-- MAIN CONTENT -->
  <main class="main-content">
    <div class="section-title">Featured</div>
    <div id="featuredSlider" class="featured-slider"></div>

    <div class="section-title">Categories</div>
    <div class="category-chips">
      <button class="category-chip active" data-category="all">All</button>
      <button class="category-chip" data-category="tech">Tech</button>
      <button class="category-chip" data-category="design">Design</button>
      <button class="category-chip" data-category="music">Music</button>
      <button class="category-chip" data-category="news">News</button>
    </div>

    <div id="postsGrid" class="posts-grid"></div>
  </main>

  <!-- Article Overlay -->
  <div class="article-overlay" id="articleOverlay">
    <div class="article-header">
      <button class="back-btn" id="backBtn">Back</button>
      <div style="flex:1"></div>
      <button class="share-btn" id="shareBtn">Share</button>
    </div>
    <div class="article-content" id="articleContent"></div>
    <div class="article-content">
      <div class="comments-wrap">
        <div class="comments-title">Comments</div>
        <div id="commentsList" class="comments-list"></div>
        <div class="comment-form">
          <textarea id="commentText" class="comment-text" rows="3" placeholder="Write a comment..."></textarea>
          <button id="commentSubmit" class="comment-submit">Send</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Search Overlay -->
  <div class="search-overlay" id="searchOverlay">
    <div class="search-header">
      <input id="searchInput" class="search-input" placeholder="Search posts..." />
      <button class="search-close" id="searchClose">Close</button>
    </div>
    <div class="search-results" id="searchResults"></div>
  </div>

  <!-- Admin Overlay -->
  <div class="admin-overlay" id="adminOverlay">
    <div class="admin-header">
      <div class="admin-title">Admin Panel</div>
      <div class="admin-actions">
        <button class="admin-close" id="adminClose">Close</button>
        <button class="admin-auth" id="adminAuthBtn">Sign in</button>
        <input type="password" id="adminPwd" placeholder="Password" />
        <button class="admin-auth" id="adminPwdUnlock">Unlock</button>
      </div>
    </div>
    <div class="admin-body">
      <div class="admin-info" id="adminInfo">Sign in required. Sign in con Google (email autorizzate) oppure sblocca con password locale per sviluppo.</div>
      <div class="admin-form" id="adminForm" style="display:none;">
        <div class="form-row">
          <label>Title</label>
          <input type="text" id="postTitle" />
        </div>
        <div class="form-row">
          <label>Slug</label>
          <input type="text" id="postSlug" placeholder="e.g. nano-banana-tutorial" />
        </div>
        <div class="form-row">
          <label>Category</label>
          <select id="postCategory">
            <option value="tech">Tech</option>
            <option value="design">Design</option>
            <option value="music">Music</option>
            <option value="news">News</option>
          </select>
        </div>
        <div class="form-row">
          <label>Cover URL</label>
          <input type="url" id="postCover" placeholder="https://..." />
        </div>
        <!-- NEW: Cover image upload with preview -->
        <div class="form-row">
          <label>Cover image (upload + anteprima)</label>
          <div class="dropzone" id="coverDrop">
            <input type="file" id="coverFile" accept="image/*" />
            <span class="dz-hint">Trascina un'immagine o clicca per selezionare (supporta GIF)</span>
          </div>
          <div class="form-row inline">
            <button id="coverUploadBtn" class="btn-secondary">Upload</button>
            <label style="display:flex; align-items:center; gap:6px;">
              <input type="checkbox" id="coverCrop" checked /> Crop 16:9 (no GIF)
            </label>
            <button id="coverCopyUrl" class="btn-secondary" title="Copia la cover URL">Copia URL</button>
            <span class="hint" id="coverUploadHint">Carica su Firebase Storage (se configurato) o usa la URL sopra.</span>
          </div>
          <div class="cover-preview">
            <div class="preview-16x9">
              <img id="coverPreview" alt="Cover preview" />
            </div>
          </div>
        </div>
        <div class="form-row">
          <label>Excerpt</label>
          <textarea id="postExcerpt" rows="2"></textarea>
        </div>
        <div class="form-row">
          <label>Content (HTML o Markdown semplice)</label>
          <textarea id="postContent" rows="10"></textarea>
        </div>
        <div class="form-row">
          <label>Anteprima contenuto</label>
          <div id="contentLivePreview" class="article" style="border:1px solid var(--border); border-radius:12px; padding:12px;"></div>
        </div>
        <!-- NEW: YouTube helper with preview -->
        <div class="form-row">
          <label>YouTube (URL o ID) + anteprima</label>
          <div class="form-row inline">
            <input type="text" id="ytInput" placeholder="https://www.youtube.com/watch?v=..." style="flex:1;" />
            <button id="ytPreviewBtn" class="btn-secondary">Anteprima</button>
            <button id="ytInsertBtn" class="btn-secondary">Inserisci nel contenuto</button>
          </div>
          <div class="video-preview" id="ytPreview"></div>
        </div>
        <!-- NEW: Content images upload -->
        <div class="form-row">
          <label>Immagini nel contenuto</label>
          <div class="dropzone" id="contentDrop">
            <input type="file" id="contentFile" accept="image/*" multiple />
            <span class="dz-hint">Trascina qui una o più immagini (supporta GIF)</span>
          </div>
        </div>
        <div class="form-row inline">
          <button id="contentUploadBtn" class="btn-secondary">Upload e inserisci</button>
          <span class="hint">Se Firebase Storage non è configurato, verrà inserita una data URL (solo per test).</span>
        </div>
        <div class="thumbs" id="contentThumbs"></div>
        <!-- NEW: Live card preview -->
        <div class="form-row">
          <label>Anteprima card</label>
          <div class="post-card preview-card">
            <div class="post-thumb" id="cardThumb"></div>
            <div class="post-body">
              <div class="post-title" id="cardTitle">Titolo</div>
              <div class="post-excerpt" id="cardExcerpt">Estratto...</div>
              <div class="post-meta"><span id="cardMeta">Tech · 5 min</span></div>
            </div>
          </div>
        </div>
        <div class="form-row inline">
          <label><input type="checkbox" id="postFeatured" /> Featured</label>
          <label> Read time <input type="text" id="postReadTime" value="5 min" style="width:100px;"/></label>
        </div>
        <div class="form-actions">
          <button id="publishPost" class="btn-primary">Publish</button>
          <button id="seedFromLocal" class="btn-secondary" title="Upload current posts (those shown on home) to Firestore">Seed from local files</button>
          <button id="downloadPost" class="btn-secondary" title="Download post HTML and JSON snippet">Download post files</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Username Claim Overlay -->
  <div class="username-overlay" id="usernameOverlay">
    <div class="username-card">
      <div class="username-header">
        <div class="username-title">Choose your username</div>
        <button class="username-close" id="usernameClose">Close</button>
      </div>
      <div class="username-body">
        <input type="text" id="usernameInput" placeholder="e.g. l457fan" />
        <div class="username-hint">No password. Username is unique and will be reserved on your device.</div>
        <div class="username-actions">
          <button id="usernameConfirm" class="btn-primary">Confirm</button>
        </div>
      </div>
      <div class="form-error" id="usernameError" style="display:none;"></div>
    </div>
  </div>
</body>
</html>