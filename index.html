<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>L457 ‚Äì Tech, Design & Music</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="styles.css" />
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
  <!-- Storage (for image uploads). Safe to include; we check availability at runtime. -->
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-storage-compat.js"></script>
  <script src="firebase-config.js"></script>
  <script defer src="script.js"></script>
</head>
<body>
  <header class="header">
    <div class="header-content">
      <a href="/" class="logo" aria-label="L457 Home">
          <img src="aaaalogo.png" alt="L457 logo" width="68" />
        </a>
      <div class="header-actions">
        <button class="search-btn" id="searchBtn">Search</button>
      </div>
    </div>
  </header>



  <!-- MAIN CONTENT -->
  <main class="main-content">
    <div class="section-title">Featured</div>
    <div id="featuredSlider" class="featured-slider"></div>

    <div class="section-title">Categories</div>
    <div class="category-chips">
      <button class="category-chip active" data-category="all">All</button>
      <button class="category-chip" data-category="tech">Tech</button>
      <button class="category-chip" data-category="design">Design</button>
      <button class="category-chip" data-category="music">Music</button>
      <button class="category-chip" data-category="news">News</button>
    </div>

    <div id="postsGrid" class="posts-grid"></div>
  </main>

  <!-- Article Overlay -->
  <div class="article-overlay" id="articleOverlay">
    <div class="article-header">
      <button class="back-btn" id="backBtn">Back</button>
      <div style="flex:1"></div>
      <button class="share-btn" id="shareBtn">Share</button>
    </div>
    <div class="article-content" id="articleContent"></div>
    <div class="article-content">
      <div class="comments-wrap">
        <div class="comments-title">Comments</div>
        <div id="commentsList" class="comments-list"></div>
        <div class="comment-form">
          <textarea id="commentText" class="comment-text" rows="3" placeholder="Write a comment..."></textarea>
          <button id="commentSubmit" class="comment-submit">Send</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Search Overlay -->
  <div class="search-overlay" id="searchOverlay">
    <div class="search-header">
      <input id="searchInput" class="search-input" placeholder="Search posts..." />
      <button class="search-close" id="searchClose">Close</button>
    </div>
    <div class="search-results" id="searchResults"></div>
  </div>

  <!-- Admin Overlay -->
  <div class="admin-overlay" id="adminOverlay">
    <div class="admin-header">
      <div class="admin-title">Admin Panel</div>
      <div class="admin-actions">
        <button class="admin-close" id="adminClose">Close</button>
        <button class="admin-auth" id="adminAuthBtn">Sign in</button>
        <input type="password" id="adminPwd" placeholder="Password" />
        <button class="admin-auth" id="adminPwdUnlock">Unlock</button>
      </div>
    </div>
    <div class="admin-body">
      <div class="admin-info" id="adminInfo">Sign in required. Sign in con Google (email autorizzate) oppure sblocca con password locale per sviluppo.</div>
      <div class="admin-form" id="adminForm" style="display:none;">
        <div class="form-row">
          <label>Title</label>
          <input type="text" id="postTitle" />
        </div>
        <div class="form-row">
          <label>Slug</label>
          <input type="text" id="postSlug" placeholder="e.g. nano-banana-tutorial" />
        </div>
        <div class="form-row">
          <label>Category</label>
          <select id="postCategory">
            <option value="tech">Tech</option>
            <option value="design">Design</option>
            <option value="music">Music</option>
            <option value="news">News</option>
          </select>
        </div>
        <div class="form-row">
          <label>Cover URL</label>
          <input type="url" id="postCover" placeholder="https://..." />
        </div>
        <!-- NEW: Cover image upload with preview -->
        <div class="form-row">
          <label>Cover image (upload + anteprima)</label>
          <div class="dropzone" id="coverDrop">
            <input type="file" id="coverFile" accept="image/*" />
            <span class="dz-hint">Trascina un'immagine o clicca per selezionare (supporta GIF)</span>
          </div>
          <div class="form-row inline">
            <button id="coverUploadBtn" class="btn-secondary">Upload</button>
            <label style="display:flex; align-items:center; gap:6px;">
              <input type="checkbox" id="coverCrop" checked /> Crop 16:9 (no GIF)
            </label>
            <button id="coverCopyUrl" class="btn-secondary" title="Copia la cover URL">Copia URL</button>
            <span class="hint" id="coverUploadHint">Carica su Firebase Storage (se configurato) o usa la URL sopra.</span>
          </div>
          <div class="cover-preview">
            <div class="preview-16x9">
              <img id="coverPreview" alt="Cover preview" />
            </div>
          </div>
        </div>
        <div class="form-row">
          <label>Excerpt</label>
          <textarea id="postExcerpt" rows="2"></textarea>
        </div>
        <div class="form-row">
          <label>Content (HTML o Markdown semplice)</label>
          <div class="editor-toolbar">
            <button type="button" id="insertImageBtn" class="btn-secondary" title="Inserisci immagine nella posizione del cursore">üì∑ Aggiungi immagine qua</button>
            <button type="button" id="insertYouTubeBtn" class="btn-secondary" title="Inserisci video YouTube nella posizione del cursore">üé• Aggiungi video qua</button>
            <button type="button" id="previewToggle" class="btn-secondary" title="Passa tra editor, preview e anteprima articolo finale">üëÅÔ∏è Preview</button>
          </div>
          <div class="editor-container">
            <textarea id="postContent" rows="15" placeholder="Scrivi il contenuto del tuo articolo qui..."></textarea>
            <div id="editorPreview" class="editor-preview" style="display:none;"></div>
          </div>
        </div>
        <div class="form-row">
          <label>Anteprima contenuto</label>
          <div id="contentLivePreview" class="article" style="border:1px solid var(--border); border-radius:12px; padding:12px;"></div>
        </div>
        <!-- NEW: YouTube helper with preview -->
        <div class="form-row">
          <label>YouTube (URL o ID) + anteprima</label>
          <div class="form-row inline">
            <input type="text" id="ytInput" placeholder="https://www.youtube.com/watch?v=..." style="flex:1;" />
            <button id="ytPreviewBtn" class="btn-secondary">Anteprima</button>
            <button id="ytInsertBtn" class="btn-secondary">Inserisci nel contenuto</button>
          </div>
          <div class="video-preview" id="ytPreview"></div>
        </div>
        <!-- NEW: Content images upload -->
        <div class="form-row">
          <label>Immagini nel contenuto</label>
          <div class="dropzone" id="contentDrop">
            <input type="file" id="contentFile" accept="image/*" multiple />
            <span class="dz-hint">Trascina qui una o pi√π immagini (supporta GIF)</span>
          </div>
        </div>
        <div class="form-row inline">
          <button id="contentUploadBtn" class="btn-secondary">Upload e inserisci</button>
          <span class="hint">Se Firebase Storage non √® configurato, verr√† inserita una data URL (solo per test).</span>
        </div>
        <div class="thumbs" id="contentThumbs"></div>
        <!-- NEW: Live card preview -->
        <div class="form-row">
          <label>Anteprima card</label>
          <div class="post-card preview-card">
            <div class="post-thumb" id="cardThumb"></div>
            <div class="post-body">
              <div class="post-title" id="cardTitle">Titolo</div>
              <div class="post-excerpt" id="cardExcerpt">Estratto...</div>
              <div class="post-meta"><span id="cardMeta">Tech ¬∑ 5 min</span></div>
            </div>
          </div>
        </div>
        <div class="form-row inline">
          <label><input type="checkbox" id="postFeatured" /> Featured</label>
          <label> Read time <input type="text" id="postReadTime" value="5 min" style="width:100px;"/></label>
        </div>
        <div class="form-actions">
          <button id="publishPost" class="btn-primary">Publish</button>
          <button id="seedFromLocal" class="btn-secondary" title="Upload current posts (those shown on home) to Firestore">Seed from local files</button>
          <button id="downloadPost" class="btn-secondary" title="Download post HTML and JSON snippet">Download post files</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Username Claim Overlay -->
  <div class="username-overlay" id="usernameOverlay">
    <div class="username-card">
      <div class="username-header">
        <div class="username-title">Choose your username</div>
        <button class="username-close" id="usernameClose">Close</button>
      </div>
      <div class="username-body">
        <input type="text" id="usernameInput" placeholder="e.g. l457fan" />
        <div class="username-hint">No password. Username is unique and will be reserved on your device.</div>
        <div class="username-actions">
          <button id="usernameConfirm" class="btn-primary">Confirm</button>
        </div>
      </div>
      <div class="form-error" id="usernameError" style="display:none;"></div>
    </div>
  </div>

  <!-- Image Insert Modal -->
  <div class="image-insert-overlay" id="imageInsertOverlay"></div>
  <div class="image-insert-modal" id="imageInsertModal" style="display:none;">
    <h3>Inserisci Immagine/i</h3>
    
    <!-- Layout Options -->
     <div class="form-row">
       <label>Layout immagini:</label>
       <div class="layout-options">
         <label class="layout-option">
           <input type="radio" name="imageLayout" value="single" checked>
           <span>üì∑ Singola</span>
         </label>
         <label class="layout-option">
           <input type="radio" name="imageLayout" value="grid-2">
           <span>üñºÔ∏è Griglia 2x</span>
         </label>
         <label class="layout-option">
           <input type="radio" name="imageLayout" value="grid-3">
           <span>üñºÔ∏è Griglia 3x</span>
         </label>
         <label class="layout-option">
           <input type="radio" name="imageLayout" value="gallery">
           <span>üé® Galleria</span>
         </label>
       </div>
     </div>
     
     <!-- Layout Controls -->
     <div class="form-row" id="layoutControls" style="display:none;">
       <label>Controlli layout:</label>
       <div class="layout-controls">
         <label class="control-option">
           <input type="checkbox" id="uniformAspect" checked>
           <span>üìê Proporzioni uniformi</span>
         </label>
         <label class="control-option">
           <input type="checkbox" id="equalHeight" checked>
           <span>üìè Altezza uniforme</span>
         </label>
       </div>
       <div class="spacing-controls">
         <label for="imageSpacing">Spaziatura:</label>
         <input type="range" id="imageSpacing" min="4" max="24" value="12" step="2">
         <span id="spacingValue">12px</span>
       </div>
     </div>
    
    <!-- File Upload Section -->
    <div class="form-row">
      <label>Carica da file:</label>
      <div class="dropzone" style="margin-bottom: 12px;">
        <input type="file" id="modalImageFile" accept="image/*" multiple />
        <span class="dz-hint">Trascina qui una o pi√π immagini o clicca per selezionare</span>
      </div>
      <div class="image-preview-grid" id="modalImagePreview"></div>
      <button id="modalUploadBtn" class="btn-primary">üì§ Carica e Inserisci</button>
    </div>
    
    <!-- URL Section -->
    <div class="form-row">
      <label>Oppure inserisci URL (una per riga):</label>
      <textarea id="modalImageUrls" placeholder="https://esempio.com/immagine1.jpg&#10;https://esempio.com/immagine2.jpg" rows="3"></textarea>
      <input type="text" id="modalImageAlt" placeholder="Testo alternativo (opzionale)" style="margin-top: 8px;" />
    </div>
    
    <!-- Layout Preview -->
    <div class="form-row" id="layoutPreviewSection" style="display:none;">
      <label>Anteprima layout:</label>
      <div class="layout-preview" id="layoutPreview"></div>
    </div>
    
    <div class="form-row inline" style="margin-top: 16px;">
      <button id="modalInsertUrlBtn" class="btn-primary">‚úÖ Inserisci URL</button>
      <button id="modalCancelBtn" class="btn-secondary">‚ùå Annulla</button>
    </div>
  </div>

</body>
</html>